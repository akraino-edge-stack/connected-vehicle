/****************************************************************************************
 *                                                                                      *
 *  ----------------------------------------------------------------------------------  *
 *  |    0    |    1    |    2    |    3    |    4     |    5    |    6    |    7    |  *
 *  ----------------------------------------------------------------------------------  *
 *  |   0x0   |   0x8   |   0x10  |   0x18  |   0x20   |   0x28  |   0x30  |   0x38  |  *
 *  ----------------------------------------------------------------------------------  *
 *  |   x18   |   x19   |   x20   |   x21   |   x22    |   x23   |   x24   |   x25   |  *
 *  ----------------------------------------------------------------------------------  *
 *  ----------------------------------------------------------------------------------  *
 *  |    8    |    9    |   10    |   11    |    12    |    13   |    14   |    15   |  *
 *  ----------------------------------------------------------------------------------  *
 *  |   0x40  |   0x48  |   0x50  |  0x58   |   0x60   |   0x68  |   0x70  |   0x78  |  *
 *  ----------------------------------------------------------------------------------  *
 *  |   x26   |   x27   |   x28   |  x29    |    LR    |    SP   |    sp   |   size  |  *
 *  ----------------------------------------------------------------------------------  *
 *  ----------------------------------------------------------------------------------  *
 *  |    16    |         |         |         |         |         |         |         |  *
 *  ----------------------------------------------------------------------------------  *
 *  |   0x80   |         |         |         |         |         |         |         |  *
 *  ----------------------------------------------------------------------------------  *
 *  |   RIP    |         |         |         |         |         |         |         |  *
 *  ----------------------------------------------------------------------------------  *
 *                                                                                      *
 * **************************************************************************************/



.text
.globl jump_fcontext 
.type jump_fcontext,@function
.align 16
jump_fcontext:
	stp	x18, x19, [x0]
	stp	x20, x21, [x0, 0x10]
	stp	x22, x23, [x0, 0x20]
	stp	x24, x25, [x0, 0x30]
	stp	x26, x27, [x0, 0x40]
	stp	x28, x29, [x0, 0x50]
	str      x30, [x0, 0x60]
	mov	x5,  sp
	str      x5,  [x0, 0x68]
	str      x30, [x0, 0x80]


	ldp x18, x19, [x1]
	ldp x20, x21, [x1, 0x10]
	ldp x22, x23, [x1, 0x20]
	ldp x24, x25, [x1, 0x30]
	ldp x26, x27, [x1, 0x40]
	ldp x28, x29, [x1, 0x50]
	ldr      x30, [x1, 0x60]
	ldr      x5,  [x1, 0x68]
	mov sp,  x5
	
	ldr      x6,  [x1, 0x80]

	mov x0,  x2

    br x6
	
.size jump_fcontext,.-jump_fcontext
